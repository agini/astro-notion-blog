---
import Layout from "../../../layouts/Layout.astro";
import { getPostCountByTag, getPostsByTagAndPage } from "@lib/notion";
import { POSTS_PER_PAGE, GAME_CATEGORY } from "@lib/constants";

export async function getStaticPaths() {
  const totalCount = await getPostCountByTag(GAME_CATEGORY);
  const totalPages = Math.ceil(totalCount / POSTS_PER_PAGE);

  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
  }));
}

const page = Number(Astro.params.page);
const posts = await getPostsByTagAndPage(GAME_CATEGORY, page);

const totalCount = await getPostCountByTag(GAME_CATEGORY);
const TOTAL_PAGES = Math.ceil(totalCount / POSTS_PER_PAGE);
---

<Layout title={`Game - Page ${page}`}>
  <h1>Game（Page {page}）</h1>

  <ul>
    {posts.map((post) => (
      <li>
        <a href={`/game/${post.slug}`}>{post.title}</a>
      </li>
    ))}
  </ul>

  <nav>
    {page > 1 && <a href={`/game/page/${page - 1}`}>Prev</a>}
    {page < TOTAL_PAGES && <a href={`/game/page/${page + 1}`}>Next</a>}
  </nav>
</Layout>
